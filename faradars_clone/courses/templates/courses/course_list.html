{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="courses-container">
 <form method="get" class="filters-bar" style="display:flex; gap:0.5rem; flex-wrap:wrap; align-items:center; justify-content:center;">
  <input type="text" name="q" placeholder="جستجو" value="{{ request.GET.q }}" style="padding:4px;">
  
  <select name="category">
    <option value="">همه دسته‌ها</option>
    {% for c in form.fields.category.queryset %}
      <option value="{{ c.id }}" {% if request.GET.category == c.id|stringformat:"s" %}selected{% endif %}>{{ c.title }}</option>
    {% endfor %}
  </select>

  <select name="tag">
    <option value="">همه تگ‌ها</option>
    {% for t in form.fields.tag.queryset %}
      <option value="{{ t.id }}" {% if request.GET.tag == t.id|stringformat:"s" %}selected{% endif %}>{{ t.name }}</option>
    {% endfor %}
  </select>

  <select name="price">
    <option value="">همه قیمت‌ها</option>
    <option value="free" {% if request.GET.price == 'free' %}selected{% endif %}>رایگان</option>
    <option value="paid" {% if request.GET.price == 'paid' %}selected{% endif %}>پولی</option>
  </select>

  <select name="sort">
    <option value="">جدیدترین</option>
    <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>ارزان‌ترین</option>
    <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>گران‌ترین</option>
    <option value="rating" {% if request.GET.sort == 'rating' %}selected{% endif %}>بیشترین امتیاز</option>
  </select>

  <button type="submit">جستجو</button>
</form>
<hr>
  <div>
    {% for course in courses %}
      <div class="course-card">
        <a href="{% url 'courses:course_detail' course.slug %}">{{ course.title }}</a>
        <div class="course-meta">
          <a href="{% url 'courses:category_courses' course.category.slug %}">{{ course.category }}</a> |
          مدرس: <a href="{% url 'instructors:profile' course.instructor.user.username %}">{{ course.instructor.get_full_name|default:course.instructor.user.username }}</a>
          | قیمت: {% if course.price == 0 %}رایگان{% else %}{{ course.price }}{% endif %}
        </div>
        <div>
          {{ course.description|truncatewords:30 }}
        </div>
      </div>
    {% empty %}
      <div class="course-card">هیچ دوره‌ای پیدا نشد.</div>
    {% endfor %}
    <!-- بعد از حلقه‌ی دوره‌ها -->
<div class="pagination mt-6 flex justify-center space-x-2">
  {% if courses.has_previous %}
    <a href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ courses.previous_page_number }}"
       class="px-3 py-1 bg-sky-200 rounded hover:bg-sky-300">قبلی</a>
  {% endif %}

  <span class="px-3 py-1 bg-white border rounded">
    صفحه {{ courses.number }} از {{ courses.paginator.num_pages }}
  </span>

  {% if courses.has_next %}
    <a href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ courses.next_page_number }}"
       class="px-3 py-1 bg-sky-200 rounded hover:bg-sky-300">بعدی</a>
  {% endif %}
</div>

  </div>
</div>
<link rel="stylesheet" href="{% static 'courses/css/style.css' %}">
{% endblock %}
